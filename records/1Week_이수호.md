# **[체크 리스트]**

## 호감상대 삭제

- [x] 호감목록 페이지에서 특정 항목에서 삭제버튼을 누르면, 해당 항목은 삭제되어야 한다.
- [x] 삭제를 처리하기 전에 해당 항목에 대한 소유권이 본인(로그인한 사람)에게 있는지 체크해야 한다.
- [x] 삭제 후 다시 호감목록 페이지로 돌아와야 한다.
- [x] rq.redirectWithMsg 함수 사용

## 구글 로그인

- [x]  카카오 로그인이 가능한것 처럼, 구글 로그인으로도 가입 및 로그인 처리가 되도록 해주세요.
- [x]  스프링 OAuth2 클라이언트로 구현해주세요.
- [x] 구글 로그인으로 가입한 회원의 providerTypeCode : GOOGLE


# **[접근 방법]**

## 호감상대 삭제

#### 1.호감상대 삭제 로직

- 일단 로직 구현이 우선이랑 생각해서 반환 타입은 건너뛰고 삭제 기능이 잘 동작하는지 확인했습니다.
- 삭제 시에 호감목록으로 입력을 담당했던 로그인된 유저와 입력되어 있는 호감의 권한 유저가 동일 인물인지 확인하고 아니라면 error 로그를 출력하도록 했습니다.
- 맞다면 호감인원 리포지토리에서 호감인원을 지우는 작업을 했습니다. 
- 동일 인물인 경우에도 삭제가 잘되는지 보기 위해 success 로그를 찍었습니다.
- 이후 서비스 계층에서 삭제가 되었다면, 컨트롤러에서 데이터가 삭제되어 있는 호감목록 페이지에 돌아오도록 했습니다.

#### 2.RsData 반환타입 설정 및 rq.redirectWithMsg으로 반환하여 출력 메세지를 꾸미기

- 호감상대에 대한 삭제 로직은 구현해두었으니, 이제 반환타입, 메세지 출력에 대한 부분을 구현하였습니다.
- 기존 Service에서 반환으로 void가 설정되어있던 부분을 RsData<LikeablePerson>으로 변경했습니다.
- 위와 같이 변경했던 이유로는 필수 사항에 반환타입으로 정해져있었긴했지만,<br>
반환타입을 rq로 한 이유로는 그램그램에는 페이지가 redirect 되었을 때 메세지를 팝업과 같이 우측 상단에 띄우는 기능이 있는데, 삭제되었다는 메세지를 표시하기 위함입니다.<br>
rq 클래스의 redirectWithMsg 메소드가 그 역할을 수행하기 때문에 반환타입으로 메소드를 사용했습니다.

## 구글 로그인

- 구글도 카카오 로그인처럼 클라우드에서 OAuth 동의설정, 사용자 인증 클라이언트 값(id, pwd) 값이 필요합니다.
- 따라서 둘다 추가를 해준후, JSON형태로 값을 다운받아보면 받을 수 있는 데이터로는 다음과 같이 값을 받을 수 있습니다.
  - 클라이언트 값(id,pwd), auth_uri, token_uri, redirect_uris 등등
- 상단의 값들을 카카오 api를 설정했던 것처럼 yml 파일에 추가합니다.
- 구글로그인시에도 세션은 저장해야 재실행시에 접속을 할 수 있기때문에 NotProd에 세션이름값을 저장했습니다.


# **[특이사항]**

처음에 발생했던 오류로 프로그램을 실행하고 종료후 재실행시에 사이트 접속이 안된다는 사항이 있었습니다.<br>
이는 이전 빌드시에 카카오로그인을 했을 경우, 카카오 세션값이 남아 있는데 재실행하게되면 카카오 세션값이 있다는 가정하에 접속을 하지만<br>
DB의 ddl-auto 옵션은 create라서 테이블을 삭제하기 때문에 있지도 않는 세션값으로 접속을 시도하기 때문에 발생하는 오류였습니다.<br>
그래서 NotProd에 초기 입력값으로 세션값을 저장해줘서 create되더라도 로그인이 될 수 있도록 하였습니다.

하면서 key값 그대로 깃허브에 push를 넣었더니, 개인 메일로 api값이 노출되었다는 경고를 받았습니다. <br>
따라서 yml 파일을 분리하고 secret키 만을 구성하는 yml 생성해서 해당 파일을 ignore 시키고, <br>
NotProd에 저장되는 username 또한 secret.yml파일에서 환경변수로 변환해서 가져다 쓰는 방법으로 수정하였습니다.

# **[Refactoring]**
- 기존 코드에는 엔티티객체로 직접 출력하고 값을 전달하는 메소드가 다수 존재하고 있어서, 각각의 도메인별로 dto 객체를 추가해서 값을 전달받고 보내주는 기능을 대신하는 작업을 할까합니다.
  

- 엔티티 객체에서 검증기가 빠진 부분이 있는거같아서, 예외처리를 위해 추가하고 검증 로직을 구현해볼까합니다.

아직 삭제로직에 대한 테스트코드가 목객체가 익숙치 않아 다르게 설계했는데, 잘 동작하지 않습니다. 개선해보려 합니다.